---
title: Rewrite URL
---

import TabItem from "@theme/TabItem";
import Tabs from "@theme/Tabs";

# Customizing Request Routing with URL Rewriting

URL rewriting allows you to modify request URLs before forwarding them to your upstream service.
This includes changing the hostname, path, or query parameters to ensure that requests are correctly formatted before reaching their destination.

By rewriting URLs at the network edge, you can:

üîÑ Standardize API request formats across different backends. <br />
üöÄ Ensure compatibility between clients and services. <br />
‚ö° Optimize backend routing without requiring changes to application code. <br />


## üîç What are the Benefits of URL Rewriting?

URL rewriting is an essential feature for API gateways, load balancers, and proxy servers, allowing for seamless request transformation before traffic reaches the backend.

Key Benefits:

- **Enable Backward Compatibility:** Allow older clients to use new API paths without breaking compatibility.
- **Simplify Microservices Routing:** Adjust URLs dynamically when forwarding requests to multiple backend services.
- **Support Multi-Tenant Architectures:** Rewrite hostnames or paths based on tenant information.
- **Optimize Load Balancing & Traffic Control:** Modify request URLs to redirect traffic efficiently.
- **Improve API Gateway Interoperability:** Ensure requests are formatted correctly for third-party APIs and microservices.
- **Path Normalization:** Standardize incoming requests (`/v1/users` ‚Üí `/api/users`).
- **Hostname Rewriting:** Change hostnames (`old.example.com` ‚Üí `new.example.com`).
- **Backend Service Path Adjustments:** Route requests to different paths without requiring frontend changes.

<Tabs groupId="kind" queryString="kind">
	<TabItem value="agent-endpoint" label="AgentEndpoint" default>
	Check out the [URL rewrite traffic policy action](/traffic-policy/actions/url-rewrite/) page for more details about how it functions and the parameters it accepts.

	```yaml
	apiVersion: ngrok.k8s.ngrok.com/v1alpha1
	kind: AgentEndpoint
	metadata:
		name: example-agent-endpoint
	spec:
		url: https://example-agent-endpoint.ngrok.io
		upstream:
			url: http://my-service.my-namespace:8080
		trafficPolicy:
			inline:
				on_http_request:
					- expressions:
							- req.url.path.startsWith('/products')
						actions:
							- type: url-rewrite
								config:
									from: /products/?([.*]+)?
									to: /products.php?query=$1
	```
	</TabItem>
	<TabItem value="cloud-endpoint" label="CloudEndpoint">
	Check out the [URL rewrite traffic policy action](/traffic-policy/actions/url-rewrite/) page for more details about how it functions and the parameters it accepts.

	```yaml
	apiVersion: ngrok.k8s.ngrok.com/v1alpha1
	kind: CloudEndpoint
	metadata:
		name: example-cloud-endpoint
	spec:
		url: https://example-cloud-endpoint.ngrok.io
		trafficPolicy:
			policy:
				on_http_request:
					- expressions:
							- req.url.path.startsWith('/products')
						actions:
							- type: url-rewrite
								config:
									from: /products/?([.*]+)?
									to: /products.php?query=$1
	```
	</TabItem>
	<TabItem value="ingress" label="Ingress">
	üí° Ingress resources do not have native URL rewriting capabilities, but they can be extended using a traffic policy.

	Check out the [URL rewrite traffic policy action](/traffic-policy/actions/url-rewrite/) page for more details about how it functions and the parameters it accepts.

	### 1. Create an `NgrokTrafficPolicy`

	```yaml
	apiVersion: ngrok.k8s.ngrok.com/v1alpha1
	kind: NgrokTrafficPolicy
	metadata:
		name: example-tp
		namespace: default
	spec:
		policy:
			on_http_request:
				- expressions:
						- req.url.path.startsWith('/products')
					actions:
						- type: url-rewrite
							config:
								from: /products/?([.*]+)?
								to: /products.php?query=$1
	```

	### 2. Use the `NgrokTrafficPolicy` on an `Ingress`

	```yaml
	apiVersion: networking.k8s.io/v1
	kind: Ingress
	metadata:
		annotations:
			k8s.ngrok.com/traffic-policy: example-tp
		name: example-ingress
		namespace: default
	spec:
		ingressClassName: ngrok
		rules:
			- host: example-ingress.ngrok.io
				http:
					paths:
						- path: /
							pathType: Prefix
							backend:
								service:
									name: example-service
									port:
										number: 80
	```
	</TabItem>
	<TabItem value="gateway-api" label="Gateway API">
	‚úÖ Gateway API natively supports URL rewriting, and this feature is fully supported by the ngrok Kubernetes operator.

	</TabItem>
</Tabs>
